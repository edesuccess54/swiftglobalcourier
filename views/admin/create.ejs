<%- include('./partials/header') %> 

    <main>
        <div class="mainWrapper">
            <%- include("./partials/sideBar") %> 
            <div class="rightContent">
                <%- include('./partials/topBar') %> 
                <div class="mainContent">
                    <div class="formContainer">
                        <form class="create-form">
                            <h2>Create Package</h2>
                            <div class="formWrapper">
                                <div class="inputGroup">
                                    <label for="sname">Sender's Name:</label>
                                    <input id="sname" type="text" name="senderName" title="senders name" >
                                </div>
    
                                <div class="inputGroup">
                                    <label for="semail">Sender's Email:</label>
                                    <input id="semail" type="text" name="senderEmail">
                                </div>
    
                                <div class="inputGroup">
                                    <label for="rname">Receiver's Name</label>
                                    <input id="rname" type="text" name="receiverName">
                                </div>
    
                                <div class="inputGroup">
                                    <label for="remail">Receiver's Email</label>
                                    <input id="remail" type="text" name="receiverEmail">
                                </div>

                                <div class="inputGroup">
                                    <label for="rnumber">Receiver's Number</label>
                                    <input id="rnumber" type="text" name="receiverNumber">
                                </div>
    
                                <div class="inputGroup">
                                    <label for="daddress">Destination Address</label>
                                    <input id="daddress" type="text" name="destination">
                                </div>

                                <div class="inputGroup">
                                    <label for="pack">package </label>
                                    <input id="pack" type="text" name="package" placeholder="what are you sending to client?">
                                </div>

                                <div class="inputGroup">
                                    <label for="weight">weight</label>
                                    <input id="weight" type="text" name="weight">
                                </div>

                                <div class="inputGroup">
                                    <label for="currentlocation">Current Location</label>
                                    <input id="currentlocation" type="text" name="currentLocation">
                                </div>

                                <div class="inputGroup">
                                    <label for="deliveryDate">Depature Date</label>
                                    <input id="deliveryDate" type="date" name="depatureDate">
                                </div>

                                <div class="inputGroup">
                                    <label for="deliveryDate">Expected Delivery Date</label>
                                    <input id="deliveryDate" type="date" name="deliveryDate">
                                </div>

                                <div class="inputGroup">
                                    <label for="deliveryDate">Shipment Method</label>
                                    <select name="shipmentMethod" id="deliveryDate">
                                        <option selected disabled>--select shipment method--</option>
                                        <option value="Express Delivery">Express Delivery</option>
                                    </select>
                                </div>

                                <div class="inputGroup">
                                    <label for="PickupDate">Pickup Date & time</label>
                                    <input id="PickupDate" type="date" name="PickupDate">
                                </div>

                                <div class="inputGroup">
                                    <label for="status">Status of item</label>
                                    <input id="status" type="text" name="status">
                                </div>
                                <button class="btn">Create</button>
                        </div>
                        </form>
                        
                    </div>
                    
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import {notification, showSpinner, hideSpinner, closeNotification} from '/admin/js/notification.js';

        const createForm = document.querySelector('.create-form')
        const btn = document.querySelector('.btn')

        toastBtn.addEventListener('click', () => closeNotification(toast))

        const createpackage = async (e) => {
            e.preventDefault()

            showSpinner(btn)

            const senderName = createForm.senderName.value
            const senderEmail = createForm.senderEmail.value
            const receiverName = createForm.receiverName.value
            const receiverEmail = createForm.receiverEmail.value
            const receiverNumber = createForm.receiverNumber.value
            const destination = createForm.destination.value
            const item = createForm.package.value
            const weight = createForm.weight.value
            const currentLocation = createForm.currentLocation.value
            const depatureDate = createForm.depatureDate.value
            const deliveryDate = createForm.deliveryDate.value
            const shipmentMethod = createForm.shipmentMethod.value
            const PickupDate = createForm.PickupDate.value
            const status = createForm.status.value

            try {
                // validation
                if(!senderName || !senderEmail|| !receiverName|| !receiverEmail|| !receiverNumber|| !destination|| !item||!weight|| !currentLocation|| !depatureDate|| !deliveryDate|| !shipmentMethod|| !PickupDate||!status) {
                    throw new Error('All fields are required');
                }

                const packages = {senderName,senderEmail,receiverName,receiverEmail,receiverNumber,destination,item,weight,currentLocation,depatureDate,deliveryDate,shipmentMethod,PickupDate,status }

                const response = await fetch("/packages/create", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(packages)
                });

                console.log(response)

                if(!response.ok) {
                    throw new Error(response.statusText);
                }

                const result = await response.json();

                if(result.error) {
                    throw new Error(result.error);
                }

                hideSpinner(btn, "Create")
                notification.success('package successfully created', toast, toastIcon, toastMessage, closeNotification);
                createForm.reset();

            } catch (error) {
                hideSpinner(btn, "Create")
                notification.error(error.message, toast, toastIcon, toastMessage, closeNotification);
                return;
            }
        }
        createForm.addEventListener('submit', createpackage);
    </script>

<%- include('./partials/footer') %> 
